# /sector-battle

특정 섹터 내에서 투자자 페르소나들이 각자 최선의 종목을 선택하고, 서로의 선택을 공격/방어하며 최종 승자를 가리는 배틀 워크플로우.

## 사용법

```
/sector-battle "AI 데이터센터"
/sector-battle "우주 산업"
/sector-battle "비트코인 채굴"
```

## 핵심 원칙

1. **컨텍스트 격리**: 각 페르소나는 반드시 독립 Agent로 실행. 하나의 Agent = 하나의 페르소나.
2. **동적 페르소나**: `.claude/personas/stocks/*.md`를 자동 스캔 (frameworks/ 제외)
3. **결과 보존**: 매 실행마다 타임스탬프로 고유 디렉토리 생성

## 저장 경로

```
reports/battles/[섹터-슬러그]/[YYYY-MM-DD_HH-MM-SS]/
├── 0_config.md        # 배틀 설정
├── 1_picks.md         # 1라운드: 선택
├── 2_attacks.md       # 2라운드: 공격
├── 3_rebuttals.md     # 3라운드: 반론
├── 4_votes.md         # 4라운드: 투표
└── 5_final.md         # 최종 결과
```

## 실행 프로세스

### 0단계: 초기화

1. 섹터명을 슬러그로 변환 (예: "AI 데이터센터" → "ai-datacenter")
2. 타임스탬프 생성 (YYYY-MM-DD_HH-MM-SS)
3. `.claude/personas/stocks/*.md` 스캔하여 참가 페르소나 목록 생성
   - `frameworks/` 디렉토리는 제외
4. 저장 디렉토리 생성
5. `0_config.md` 작성 (섹터명, 참가자 목록, 실행 시간)

### 1라운드: 선택 (N개 Agent 병렬)

**각 페르소나 Agent에게 전달할 내용:**
- 섹터명
- 해당 페르소나 정의 파일 내용
- 투자자 프로필 (`.claude/investor_profile.md`)

**각 Agent 태스크:**
```
당신은 [페르소나명]입니다.

[페르소나 정의 내용]

---

투자자 프로필:
[investor_profile.md 내용]

---

## 태스크

"[섹터명]" 섹터에서 당신의 투자 철학에 가장 부합하는 종목을 **반드시 1개만** 선택하세요.

### 출력 형식 (JSON)

{
  "persona": "[페르소나명]",
  "sector": "[섹터명]",
  "pick": "[티커]" 또는 "PASS",
  "conviction": 1-10,
  "thesis": "선택 이유 (3-5문장)",
  "key_metrics": ["핵심 지표 1", "핵심 지표 2", "핵심 지표 3"],
  "risks": ["주요 리스크 1", "주요 리스크 2"]
}

### 규칙
- 반드시 1개만 선택 (복수 선택 불가)
- 섹터 내 마음에 드는 종목이 없으면 "PASS" 가능
- PASS 시에도 이유 필수
- WebSearch를 활용하여 섹터 내 주요 기업들을 조사할 것
```

**출력**: `1_picks.md`에 모든 페르소나의 선택 기록

### 2라운드: 공격 (N개 Agent 병렬)

**각 페르소나 Agent에게 전달할 내용:**
- 1라운드 결과 (`1_picks.md` 내용)
- 해당 페르소나 정의 파일 내용

**각 Agent 태스크:**
```
당신은 [페르소나명]입니다.

[페르소나 정의 내용]

---

## 1라운드 결과

[1_picks.md 내용]

---

## 태스크

다른 페르소나들의 선택을 당신의 투자 철학 관점에서 비판하세요.

### 출력 형식 (JSON)

{
  "persona": "[페르소나명]",
  "my_pick": "[내 선택]",
  "attacks": [
    {
      "target_persona": "[공격 대상 페르소나]",
      "target_pick": "[대상의 선택]",
      "criticism": "비판 내용 (2-3문장)",
      "fatal_flaw": "치명적 약점 한 줄"
    },
    ...
  ]
}

### 규칙
- 자신의 선택은 공격하지 않음
- PASS한 페르소나도 다른 선택들을 비판할 수 있음
- 같은 종목을 선택한 페르소나는 공격 대상에서 제외
- 구체적인 수치/근거로 비판할 것
```

**출력**: `2_attacks.md`에 모든 공격 기록

### 3라운드: 반론 (N개 Agent 병렬)

**각 페르소나 Agent에게 전달할 내용:**
- 자신에게 온 공격만 필터링하여 전달
- 해당 페르소나 정의 파일 내용
- 자신의 1라운드 선택

**각 Agent 태스크:**
```
당신은 [페르소나명]입니다.

[페르소나 정의 내용]

---

## 당신의 선택

[1라운드에서의 본인 선택]

---

## 당신에게 온 공격

[본인 향한 attacks만 필터링]

---

## 태스크

당신에게 온 비판에 반박하세요.

### 출력 형식 (JSON)

{
  "persona": "[페르소나명]",
  "my_pick": "[내 선택]",
  "rebuttals": [
    {
      "attacker": "[공격자 페르소나]",
      "original_criticism": "원래 비판 요약",
      "rebuttal": "반박 내용 (2-3문장)",
      "counter_evidence": "반박 근거"
    },
    ...
  ],
  "conviction_change": "유지/상승/하락",
  "updated_conviction": 1-10
}

### 규칙
- 모든 공격에 반박할 것
- 타당한 비판은 인정하되, 왜 여전히 본인 선택이 옳은지 설명
- conviction이 하락해도 솔직하게 표현
```

**출력**: `3_rebuttals.md`에 모든 반론 기록

### 4라운드: 투표 (N개 Agent 병렬)

**각 페르소나 Agent에게 전달할 내용:**
- 전체 배틀 요약 (picks, attacks, rebuttals)
- 해당 페르소나 정의 파일 내용

**각 Agent 태스크:**
```
당신은 [페르소나명]입니다.

[페르소나 정의 내용]

---

## 배틀 전체 요약

[1_picks.md + 2_attacks.md + 3_rebuttals.md 요약]

---

## 태스크

모든 논쟁을 검토한 후, 본인을 제외하고 가장 설득력 있는 페르소나에게 1표를 행사하세요.

### 출력 형식 (JSON)

{
  "persona": "[페르소나명]",
  "my_original_pick": "[내 원래 선택]",
  "vote_for": "[투표 대상 페르소나]",
  "vote_reason": "투표 이유 (2-3문장)",
  "concession": "패배 시 승복 코멘트 (상대 선택의 장점 인정)",
  "final_conviction_in_own_pick": 1-10,
  "lessons_learned": "이번 배틀에서 배운 점"
}

### 규칙
- 자신에게 투표 불가
- PASS한 페르소나도 투표권 있음
- 반드시 1표 행사 (기권 불가)
- 솔직하게 승복할 것
```

**출력**: `4_votes.md`에 모든 투표 기록

### 5단계: 최종 집계 (1 Agent, 페르소나 없음)

**중립 Agent에게 전달할 내용:**
- 0_config.md ~ 4_votes.md 전체

**Agent 태스크:**
```
당신은 중립적인 배틀 심판입니다. 어떤 투자 철학에도 편향되지 않습니다.

---

## 배틀 전체 기록

[0_config.md ~ 4_votes.md 전체 내용]

---

## 태스크

배틀 결과를 집계하고 최종 리포트를 작성하세요.

### 출력 형식 (Markdown)

# Sector Battle 결과: [섹터명]

## 실행 정보
- 일시: [타임스탬프]
- 참가자: [N명]
- 섹터: [섹터명]

## 🏆 최종 승자

**[승자 페르소나]** - [선택 종목]

### 득표 현황
| 페르소나 | 선택 | 득표 |
|---------|------|------|
| ... | ... | ... |

### 승리 요인
[왜 이 선택이 가장 설득력 있었는지 3-5문장]

## 핵심 논쟁 요약

### 논쟁 1: [주제]
- 정: [주장]
- 반: [반박]
- 결론: [누가 이겼는지]

### 논쟁 2: ...

## 각 페르소나 최종 포지션

| 페르소나 | 원래 선택 | 최종 확신도 | 승복 여부 |
|---------|----------|------------|----------|
| ... | ... | ... | ... |

## 투자자를 위한 시사점

[이 배틀에서 얻을 수 있는 인사이트 3-5개]

## 주의사항

[승자 선택에도 존재하는 리스크, 패자들의 비판 중 유효한 것들]
```

**출력**: `5_final.md`

## Agent 호출 요약

```
0단계: 초기화           - 0 Agent (파일 스캔/생성만)
1라운드: 선택           - N Agents (병렬)
2라운드: 공격           - N Agents (병렬)
3라운드: 반론           - N Agents (병렬)
4라운드: 투표           - N Agents (병렬)
5단계: 집계             - 1 Agent
────────────────────────────────────────
총:                     4N + 1 Agents
```

N = 페르소나 수 (현재 6명이면 25 Agents)

## 주의사항

1. **컨텍스트 격리 필수**: 각 Agent는 새로 생성. resume 금지.
2. **병렬 실행**: 같은 라운드 내 Agent들은 반드시 병렬 실행
3. **순차 의존**: 라운드 간에는 순차 실행 (이전 라운드 결과 필요)
4. **WebSearch 활용**: 1라운드에서 섹터 리서치 시 적극 활용
5. **JSON 파싱**: 각 라운드 출력은 JSON으로 받아 다음 라운드 입력으로 가공
